---
layout: post
title: IPV6的学习理解
category: computer-net
tags: [computer-net]
excerpt: IPV6的学习理解
---

> 原创

## IPV6的学习理解

@[toc]
[理解链路本地址与站点本地地址](https://blog.51cto.com/12046523/1890818)
[IPv6地址格式简介以及常见的IP地址](https://blog.csdn.net/u011003120/article/details/88398371#27_200116_48)

###  一、单播地址（Unicast IPv6 Addresses）


#### 1、可聚合的全球单播地址（Aggregatable Global Unicast Addresses）
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191011123527443.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0p1c3RpbkxlZTIwMTU=,size_16,color_FFFFFF,t_70)
可在全球范围内路由和到达的，相当于IPv4里面的global addresses。前三个bit是001，地址范围：

>  2000:: -- 3FFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF
> 例如：2000::1:2345:6789:abcd 
> 又例如：3000::1:2345:6789:abcd

这个前缀中总共包含8192个/16的前缀。
其中：
- 2001::/16	目前实际用于IPV6因特网运作的前缀
- 2002::/16	为使用6-TO-4过渡机制的节点保留
- 3FFE::/16	早期的IPv6 6bone试验网单播地址（已经停用，网段被预留）

> 依据RFC3701，6bone的地址空间3FFE::/16已经于2006年6月6日停用。所有使用6bone前缀的网络必须过渡到使用由RIR分配的商用IPv6地址空间。CERNET自1998年11月获得6bone
> pTLA前缀3FFE:3200::/24以来，参与6bone的试验并为我国部署IPv6网络积累了经验。6bone地址停用后，原有的隧道为主的试验网如何成功过渡，是当前必须认真考虑的紧迫议题。

全局单播地址是最常用的IPv6单播地址。如果一个机构被分配了一块地址空间，并且只有一个地址前缀通过一个唯一的上游服务提供商接入IPv6 Internet，那么这方面并不需要特别的考虑。

但一个多接入的（Multihomed）网络可能需要考虑如何使用两个以上服务提供商所分配的地址空间。如何使用多个地址前缀取决于采用多接入的根本原因——有弹性的故障保护、负载均衡、实施策略路由，或者解决重新编址（renumbering）的过渡问题。IPv6已经改进了主机对多地址的支持，实现了主机默认地址的选择算法（参见RFC3484: Default Address Selection for IPv6）。多接入的主机如果含有两个不同前缀的全局地址，那么其源地址或者目的地址将按RFC3484所描述的那样去选择。


##### 接口ID
EUI-64格式：扩展惟一标识符

在IPV6中，无状态自动配置机制使用EUI-64格式来自动配置IPV6地址
所谓无状态自动配置是指在网络中没有DHCP服务器的情况下，允许节点自行配置IPV6地址的机制。
EUI-64的构造规则--根据接口的MAC地址再加上固定的前缀来生成一个IPV6的地址
工作原理：自动将48bit的以太网MAC地址扩展成64bit，再挂在一个64bit的前缀后面，组成一个IPV6地址

IPv6有三种不同类型的单播地址格式。地址（最后64位）的后半部分总是用于接口ID。系统的MAC地址是由48位并以十六进制表示。 MAC地址被认为是唯一分配全球范围内。接口ID采用此MAC地址的唯一性的优势。通过使用IEEE的扩展唯一标识符（EUI-64）格式的主机可以自动配置其接口ID。首先，主机会将其自己的MAC地址分为两个24位半。那么16位十六进制值0xFFFE的被夹到MAC地址的那两半，导出64位接口ID。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191011123650668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0p1c3RpbkxlZTIwMTU=,size_16,color_FFFFFF,t_70)





#### 2、链路本地地址（Link-Local Addresses）
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191011123745136.png)
用于同一个链路上的相邻节点之间通信，相当于IPv4里面的169.254.0.0/16地址。Ipv6的路由器不会转发链路本地地址的数据包。前10个bit是1111 1110 10，由于最后是64bit的interface ID，所以它的前缀总是FE80::/64	（后面的零是标准中规定的）
例如：FE80::1

ipv6中：强制性自动分配，机通过MAC地址自动配置生成IPv6地址
ipv4中：DHCP分配失败会分配
只能用于网段内通信，路由器不会转发此类数据包
IPv6网络没有ARP，ARP是在二层网络确认每个MAC和IP的对应。该地址解决了这种问题，使得二层地址被三层网络唯一标识。
链路本地地址，是从MAC映射而的，很多回答是“完成邻居发现”，其实它就是个二层地址。之所以映射出来，是为了这些地址进行更好的管理和运用(如完成ARP功能)。不然直接使用MAC地址不就行了。
链路本地地址就是二层地址，因此它不会在三层网络设备如路由器之间通信。
IPv6本地链路地址生成方式 .

#### ~~站点本地地址（Site-Local Addresses）~~ 
（2019年的现在，这个早已被ULA取代，不再使用，这个网段被国际组织预留）

> 对于无法访问internet的本地网络，可以使用站点本地地址，这个相当于IPv4里面的private address（10.0.0.0/8,
> 172.16.0.0/12, and 192.168.0.0/16）。它的前10个bit是1111 1110 11，它最后是16bit的Subnet ID和64bit的interface ID，所以它的前缀是FEC0::/48。
> 值得注意的是，在RFC3879中，最终决定放弃单播站点本地地址。放弃的理由是，由于其固有的二义性带来的单播站点本地地址的复杂性超过了它们可能带来的好处。它在RFC4193中被ULA取代。

#### 3、唯一的本地IPv6单播地址（ULA，Unique Local IPv6 Unicast Address）
RFC4193中标准化了一种用来在本地通信中取代单播站点本地地址的地址。ULA拥有固定前缀FD00::/8，后面跟一个被称为全局ID的40bit随机标识符。

> 用法上，ULA和IPv4的私有地址十分类似，但它具有近似的全局唯一性。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191011123959832.png)
图 1.3

**ULA在大网中的使用：**

> 由于随机选择40位的Global ID，FC00::/7地址块内的大量ULA前缀必然是不聚类的。然而注意到在一个/48大小的ULA
> Global ID之下，仍然有16位的子网ID可供使用，适当分配ULA Global
> ID，尽量将逻辑上属于同一对象的网络规划到子网范畴以内，也是避免大网内部路由产生过多more-specifics的有效途径。


图1.3是ULA的地址结构示意图。其中，FC00::/7是ULA类型的前缀。作为一个统一前缀，有利于限制边界网关将这类地址的路由控制在一定范围之内。L是局部标志，置位表示后面的Global ID是各网络独自选择的；40位的Global ID由各网络独自随机选择，随机性保证一个ULA前缀在很大概率上是全局唯一的，因此，ULA并不要求部署它的管理员向一个全球机构注册使用某个前缀。在网络变换其服务提供商及对应的全局地址前缀时，ULA的地址编址体制可以保持不变，因此网络内部的运行将不因重编址而受到影响。

网络在部署ULA同时一般也部署全局地址，因此主机一般都同时分配有这样两种地址。默认地址选择算法能够正确选取源和目的地址，即如果源和目的主机都包含ULA地址时，则选择ULA地址。由于ULA前缀和一个全局的站点网络前缀都是48位的，因此管理员可以考虑对这二者采用一致的子网编址方案。

ULA使用中的一个典型问题是对IPv6组播的影响。IPv6默认地址选择算法会优先考虑ULA地址作为一个IPv6组播流的源地址。这个选择在IPv6组播流发往IPv6 Internet时是不正确的,因为ULA不是全局可路由的，将导致该组播会话的反向路径传递（RPF）在这个内部网络以外失效。

#### 4、Unspecified Address　　 0:0:0:0:0:0:0:0/128 => ::/128
#### 5、Loopback Address 　　　 0:0:0:0:0:0:0:1/128 => ::1/128
#### 6、IPv4 Compatible Address ::192.168.30.1 => ::C0A8:1E01


### 二、多播IPv6地址（Multicast IPv6 Addresses）
前8个bit为1111 1111，
 

 - 其中FF01::到FF0F::的多播地址是保留专用地址
- FF01::1 节点本地范围所有节点多播地址
- FF02::1 链路本地范围所有节点多播地址
- FF01::2 节点本地范围所有路由器多播地址
- FF02::2 链路本地范围所有路由器多播地址
- FF05::2 站点本地范围所有路由器多播地址


### 三、设计小结
总的来说，地址分配可以依据某种特定的逻辑来分割已经从RIR获得的地址前缀。这些设计逻辑可以包含对以下因素的考察:
地理边界——同一地区的所有子网分配相同的前缀;
组织机构边界——同一机构或同一类型机构的联合体分配相同的前缀;
业务类别——为某些特定的业务预留地址前缀，如：VoIP、内容分发服务、无线接入、ADSL接入等等;
这些方面和IPv4的地址规划类似。然而设计者务必同时考虑到以下IPv6特定的问题：
前缀聚类；
网络的增长，特别是增长过程中是否还能保持聚类；

表1　IPv6的地址类型及其所占地址空间的比重
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191011124146810.png)
通过与RFC2373对比可知，RFC3513取消了为NSAP和IPX等保留的地址，将原来的保留地址全部划入了全球单播地址的行列，从而大大扩展了全球单播地址的空间。


### 校园网络（教育网）
1、校园网 WIFI认证后获得公网IP，IP范围属于教育网
2、办公场所**有线**web认证后也获得公网IP，IP范围属于教育网；
3、寝室web认证的也是公网IP，不属于教育网。

校园网 WIFI和办公区WEB认证登陆的账号分配了IPV6地址，可以使用Google和youtube服务，不知道是教育网的原因还是IPV6访问的原因。